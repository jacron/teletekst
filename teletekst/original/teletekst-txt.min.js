"use strict";
(function () {
    var btns_fc = getAllElementsWithAttribute('data-fontsize'), btns_pager = getAllElementsWithAttribute('data-pager'),
        container = document.getElementById('container'), cookieName = 'tt-FontSize';
    for (var i = 0; i < btns_fc.length; i++) {
        btns_fc[i].onclick = function (event, link) {
            event = event || window.event;
            changeFontSize((event.currentTarget) ? event.currentTarget : event.srcElement);
        };
    }
    if (false !== getCookie(cookieName)) {
        container.style.fontSize = getCookie(cookieName) + 'em';
    }
    document.onkeydown = function (event) {
        event = event || window.event;
        handleKeyInput(event);
    };
    document.getElementById('navi').focus();

    function handleKeyInput(ev) {
        var keyCode = ev.keyCode || ev.which;
        var key = {left: 37, up: 38, right: 39, down: 40, pageDown: 34, pageUp: 33};
        if (keyCode >= 48 && keyCode <= 57) {
            document.getElementById('navi').focus();
            return;
        }
        switch (keyCode) {
            case key.left:
            case key.pageDown:
                followLink(btns_pager[0]);
                break;
            case key.right:
            case key.pageUp:
                followLink(btns_pager[3]);
                break;
            case key.up:
                followLink(btns_pager[1]);
                break;
            case key.down:
                followLink(btns_pager[2]);
                break;
        }
        return;
    }

    function followLink(link) {
        var url = link.href;
        if (url && url.length > 0) {
            window.location = url;
        }
    }

    function changeFontSize(element) {
        var fs, target = element.getAttribute('data-fontsize');
        switch (target) {
            case'large':
                fs = 1.5;
                break;
            case'xlarge':
                fs = 1.7;
                break;
            default:
                fs = 1.2;
                break;
        }
        setCookie(cookieName, fs, 365);
        container.style.fontSize = fs + 'em';
    }

    function getAllElementsWithAttribute(attribute) {
        var matchingElements = [], allElements = document.getElementsByTagName('*'), len = allElements.length;
        for (var i = 0; i < len; i++) {
            if (allElements[i].getAttribute(attribute)) {
                matchingElements.push(allElements[i]);
            }
        }
        return matchingElements;
    }

})();
